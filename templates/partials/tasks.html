{{if eq .Tab "active"}}

  {{if and (eq (len .Active) 0) (eq (len .Queued) 0)}}
  <div class="text-center py-12 text-zinc-400">
    <div class="text-3xl mb-2 opacity-30">◎</div>
    <div class="text-sm">Nothing here yet</div>
    <div class="text-xs text-zinc-400 mt-1">Tap + New Task to get started</div>
  </div>
  {{end}}

  {{range .Active}}
  <div class="card mb-2.5 cursor-pointer active:scale-[0.98] transition-transform shadow-sm" onclick="openDetail('{{.ID}}')">
    <div class="flex justify-between items-start mb-2.5">
      <div class="text-base font-semibold flex-1 mr-3 leading-tight">{{.Prompt}}</div>
      <div class="badge text-green-600 bg-green-500/10">
        <span class="inline-block w-2.5 h-2.5 border-2 border-green-600 border-t-transparent rounded-full animate-spin-slow align-middle mr-1"></span>
        active
      </div>
    </div>
    <div class="flex gap-1.5 items-center mb-3">
      {{if .Platform}}<div class="chip">{{.PlatformName}}</div>{{end}}
      <div class="chip text-zinc-400">{{.Elapsed}}</div>
      {{if .Stale}}<div class="chip text-orange-500 bg-orange-500/10 font-semibold">⚠ stale</div>{{end}}
    </div>
    <div class="text-xs text-zinc-400 mb-2">{{.TokensStr}} tokens burned</div>
    <div class="h-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-full overflow-hidden">
      <div class="h-full rounded-full transition-all duration-700 {{if .Stale}}bg-gradient-to-r from-orange-700 to-orange-500{{else}}bg-gradient-to-r from-green-700 to-green-500{{end}}" style="width:{{.ProgressPct}}%"></div>
    </div>
  </div>
  {{end}}

  {{if gt (len .Queued) 0}}
  <div class="flex items-center gap-2.5 my-5">
    <div class="flex-1 h-px bg-zinc-200 dark:bg-zinc-800"></div>
    <div class="text-[11px] font-semibold text-zinc-400 uppercase tracking-widest">Waiting</div>
    <div class="flex-1 h-px bg-zinc-200 dark:bg-zinc-800"></div>
  </div>
  {{range .Queued}}
  <div class="card mb-2 shadow-sm">
    <div class="flex items-center gap-2">
      <div class="flex-1 min-w-0">
        <div class="text-[15px] font-medium">{{.Prompt}}</div>
        <div class="text-xs text-zinc-400 mt-0.5">#{{.ID}} · {{.Elapsed}}</div>
      </div>
      <button hx-post="/api/tasks/run" hx-vals='{"id":"{{.ID}}"}' hx-swap="none"
              class="w-9 h-9 rounded-xl border border-green-500 text-green-500 flex items-center justify-center text-sm font-bold cursor-pointer hover:bg-green-500 hover:text-white active:scale-90 transition-all shrink-0">▶</button>
      <button hx-post="/api/tasks/delete" hx-vals='{"id":"{{.ID}}"}' hx-swap="none" hx-confirm="Delete this task?"
              class="w-9 h-9 rounded-xl border border-zinc-200 dark:border-zinc-700 text-zinc-400 flex items-center justify-center text-sm cursor-pointer hover:text-red-500 hover:border-red-500 active:scale-90 transition-all shrink-0">✕</button>
    </div>
  </div>
  {{end}}
  {{end}}

{{else}}

  {{if eq (len .Done) 0}}
  <div class="text-center py-12 text-zinc-400">
    <div class="text-3xl mb-2 opacity-30">✓</div>
    <div class="text-sm">Nothing completed yet</div>
    <div class="text-xs text-zinc-400 mt-1">Completed tasks appear here</div>
  </div>
  {{end}}

  {{range .Done}}
  <div class="card mb-2 relative overflow-hidden shadow-sm">
    <div class="text-[15px] font-medium">
      <span class="text-base mr-2 {{if eq .Status "failed"}}text-red-500{{else}}text-green-500{{end}}">{{if eq .Status "failed"}}✗{{else}}✓{{end}}</span>
      {{.Prompt}}
    </div>
    <div class="flex gap-2 items-center mt-1.5 text-[11px] text-zinc-400">
      {{if .Platform}}<span>{{.Platform}}</span>{{end}}
      <span>{{.TokensStr}} burned</span>
    </div>
  </div>
  {{end}}

{{end}}
