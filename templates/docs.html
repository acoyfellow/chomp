{{define "layout"}}
<!DOCTYPE html>
<html lang="en" class="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>chomp — API docs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root { --bg: #fafafa; --card: #fff; --border: #e4e4e7; --text: #18181b; --muted: #71717a; --code-bg: #f4f4f5; --accent: #c8a630; --green: #16a34a; --red: #dc2626; }
  .dark { --bg: #09090b; --card: #18181b; --border: #27272a; --text: #fafafa; --muted: #a1a1aa; --code-bg: #27272a; --accent: #c8a630; --green: #4ade80; --red: #f87171; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'Sora', system-ui, sans-serif; font-size: 15px; line-height: 1.7; -webkit-font-smoothing: antialiased; }
  .container { max-width: 680px; margin: 0 auto; padding: 2rem 1.25rem 4rem; }
  h1 { font-size: 1.75rem; font-weight: 700; letter-spacing: -0.03em; margin-bottom: 0.25rem; }
  h1 span { color: var(--accent); }
  .subtitle { color: var(--muted); font-size: 0.9rem; margin-bottom: 2.5rem; }
  h2 { font-size: 1.1rem; font-weight: 700; letter-spacing: -0.02em; margin: 2.5rem 0 0.75rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--border); }
  h3 { font-size: 0.95rem; font-weight: 600; margin: 1.5rem 0 0.5rem; }
  p { margin-bottom: 0.75rem; }
  code { font-family: 'SF Mono', Menlo, monospace; font-size: 0.85em; background: var(--code-bg); padding: 0.15em 0.4em; border-radius: 4px; }
  pre { background: var(--code-bg); border: 1px solid var(--border); border-radius: 10px; padding: 1rem 1.25rem; overflow-x: auto; margin-bottom: 1rem; font-size: 0.82rem; line-height: 1.6; }
  pre code { background: none; padding: 0; font-size: inherit; }
  .method { display: inline-block; font-size: 0.7rem; font-weight: 700; padding: 0.2em 0.6em; border-radius: 4px; margin-right: 0.5em; vertical-align: middle; text-transform: uppercase; letter-spacing: 0.05em; }
  .method.get { background: rgba(59,130,246,0.15); color: #3b82f6; }
  .method.post { background: rgba(34,197,94,0.15); color: var(--green); }
  .endpoint { font-family: 'SF Mono', Menlo, monospace; font-size: 0.95rem; font-weight: 600; }
  .field-table { width: 100%; border-collapse: collapse; margin: 0.5rem 0 1rem; font-size: 0.85rem; }
  .field-table th { text-align: left; font-weight: 600; color: var(--muted); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; padding: 0.4rem 0.75rem; border-bottom: 1px solid var(--border); }
  .field-table td { padding: 0.4rem 0.75rem; border-bottom: 1px solid var(--border); vertical-align: top; }
  .field-table td:first-child { font-family: 'SF Mono', Menlo, monospace; font-size: 0.82rem; white-space: nowrap; }
  .badge { display: inline-block; font-size: 0.65rem; font-weight: 700; padding: 0.1em 0.5em; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.03em; vertical-align: middle; margin-left: 0.4em; }
  .badge.required { background: rgba(220,38,38,0.12); color: var(--red); }
  .badge.optional { background: rgba(113,113,122,0.12); color: var(--muted); }
  .back { display: inline-flex; align-items: center; gap: 0.4em; color: var(--muted); text-decoration: none; font-size: 0.85rem; font-weight: 500; margin-bottom: 1.5rem; }
  .back:hover { color: var(--text); }
  .note { background: var(--code-bg); border-left: 3px solid var(--accent); padding: 0.75rem 1rem; border-radius: 0 8px 8px 0; margin-bottom: 1rem; font-size: 0.85rem; }
  .note strong { color: var(--accent); }
  a { color: var(--accent); }
  .theme-btn { position: fixed; top: 1rem; right: 1rem; width: 36px; height: 36px; border-radius: 50%; border: 1px solid var(--border); background: var(--card); color: var(--muted); cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; }
</style>
</head>
<body>
<button class="theme-btn" onclick="document.documentElement.classList.toggle('dark')">☾</button>
<div class="container">

<a href="/" class="back">← dashboard</a>

<h1>chomp<span>.</span> API</h1>
<p class="subtitle">Dispatch prompts to free AI models. Poll for results. Burn tokens at zero cost.</p>

<div class="note">
  <strong>Auth required.</strong> All dispatch endpoints need <code>Authorization: Bearer &lt;token&gt;</code>. The <code>/api/models/free</code> endpoint is public.
</div>

<h2>Dispatch a prompt</h2>
<p><span class="method post">POST</span> <span class="endpoint">/api/dispatch</span></p>
<p>Send a prompt to a free model. Returns immediately with a job ID. The model runs async — poll <code>/api/result/:id</code> for the response.</p>

<h3>Request body</h3>
<table class="field-table">
  <tr><th>Field</th><th>Type</th><th>Description</th></tr>
  <tr><td>prompt</td><td>string</td><td>The prompt to send <span class="badge required">required</span></td></tr>
  <tr><td>model</td><td>string</td><td>Model ID, or <code>"auto"</code> to pick best free model <span class="badge optional">optional</span></td></tr>
  <tr><td>system</td><td>string</td><td>System prompt <span class="badge optional">optional</span></td></tr>
</table>

<h3>Example</h3>
<pre><code>curl -X POST https://chomp.coey.dev/api/dispatch \
  -H "Authorization: Bearer $CHOMP_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"prompt": "Explain quicksort in 3 sentences.", "model": "auto"}'</code></pre>

<h3>Response</h3>
<pre><code>{
  "id": "1",
  "model": "stepfun/step-3.5-flash:free",
  "status": "running"
}</code></pre>

<h2>Poll for result</h2>
<p><span class="method get">GET</span> <span class="endpoint">/api/result/:id</span></p>
<p>Returns the job status and result once complete.</p>

<h3>Response (done)</h3>
<pre><code>{
  "id": "1",
  "model": "stepfun/step-3.5-flash:free",
  "status": "done",
  "result": "Quicksort picks a pivot element...",
  "tokens_in": 25,
  "tokens_out": 87,
  "latency_ms": 3200,
  "created": "2026-02-14T13:06:30Z",
  "finished": "2026-02-14T13:06:33Z"
}</code></pre>

<h3>Status values</h3>
<table class="field-table">
  <tr><th>Status</th><th>Meaning</th></tr>
  <tr><td>running</td><td>Model is processing</td></tr>
  <tr><td>done</td><td>Result ready in <code>result</code> field</td></tr>
  <tr><td>error</td><td>Failed — see <code>error</code> field</td></tr>
</table>

<h2>List jobs</h2>
<p><span class="method get">GET</span> <span class="endpoint">/api/jobs</span></p>
<p>Returns the 50 most recent jobs, newest first.</p>

<h2>Free models</h2>
<p><span class="method get">GET</span> <span class="endpoint">/api/models/free</span></p>
<p>Returns currently available free models on OpenRouter. Cached 15 minutes. <strong>No auth required.</strong></p>

<h3>Response</h3>
<pre><code>{
  "count": 23,
  "models": [
    {
      "id": "stepfun/step-3.5-flash:free",
      "name": "StepFun: Step 3.5 Flash",
      "context_length": 256000
    },
    ...
  ]
}</code></pre>

<h2>How model selection works</h2>
<p>When <code>model</code> is <code>"auto"</code> or omitted, chomp picks the free model with the largest context window. Free models rotate weekly on OpenRouter — the scanner refreshes every 15 minutes.</p>
<p>To target a specific model, pass its full ID (e.g. <code>"deepseek/deepseek-r1-0528:free"</code>). Check <code>/api/models/free</code> for what's currently available.</p>

<h2>Rate limits</h2>
<p>Free models have per-minute and per-day rate limits set by OpenRouter. If a model returns 429, try another or wait. The <code>auto</code> selector doesn't yet handle fallback — that's coming.</p>

</div>
</body>
</html>
{{end}}
