*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#FFFFFF;--bg1:#F7F7F8;--bg2:#EFEFEF;--bg3:#E4E4E7;
  --border:#E4E4E7;--border2:#D4D4D8;
  --t1:#18181B;--t2:#71717A;--t3:#A1A1AA;
  --gold:#C8A630;--blue:#4F6EC5;--purple:#9B4FBF;
  --green:#16A34A;--red:#DC2626;--orange:#D96F0E;
  --ease:cubic-bezier(.22,1,.36,1);
  --font:'Sora',system-ui,-apple-system,sans-serif;
  --shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --shadow2:0 4px 12px rgba(0,0,0,.08);
}
[data-theme="dark"]{
  --bg:#09090b;--bg1:#111114;--bg2:#18181b;--bg3:#27272a;
  --border:#27272a;--border2:#3f3f46;
  --t1:#fafafa;--t2:#a1a1aa;--t3:#52525b;
  --gold:#E8C872;--blue:#7B93DB;--purple:#C97BDB;
  --green:#34D399;--red:#F87171;--orange:#F6821F;
  --shadow:0 1px 3px rgba(0,0,0,.3);--shadow2:0 4px 12px rgba(0,0,0,.4);
}
html{height:100%;background:var(--bg)}
body{font-family:var(--font);background:var(--bg);color:var(--t1);font-size:15px;line-height:1.5;-webkit-font-smoothing:antialiased;min-height:100%;overflow-x:hidden;transition:background .3s var(--ease),color .3s var(--ease)}

/* ── Boot ── */
.boot{position:fixed;inset:0;z-index:200;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;animation:bootOut .4s 1.8s var(--ease) forwards;transition:background .3s}
.boot-mark{font-size:32px;font-weight:700;letter-spacing:-1px;opacity:0;animation:fadeUp .5s .15s var(--ease) forwards}
.boot-mark span{color:var(--gold)}
.boot-line{width:48px;height:2px;background:var(--bg3);border-radius:1px;overflow:hidden;opacity:0;animation:fadeUp .3s .4s var(--ease) forwards}
.boot-line::after{content:'';display:block;height:100%;width:0;background:var(--gold);border-radius:1px;animation:loadBar .9s .6s var(--ease) forwards}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}from{transform:translateY(6px)}}
@keyframes loadBar{to{width:100%}}
@keyframes bootOut{to{opacity:0;pointer-events:none}}

/* ── App ── */
.app{opacity:0;animation:fadeUp .5s 2s var(--ease) forwards;max-width:600px;margin:0 auto;padding:0 0 env(safe-area-inset-bottom)}

/* ── Summary ── */
.summary{display:flex;justify-content:space-around;padding:20px 16px 12px;}
.sum-item{text-align:center}
.sum-val{font-size:20px;font-weight:700;letter-spacing:-0.5px}
.sum-val.hot{color:var(--gold)}
.sum-label{font-size:11px;color:var(--t3);margin-top:1px}
.sum-live{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--green);margin-right:4px;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* ── Tabs ── */
.tabs{display:flex;gap:4px;padding:0 16px 12px;position:sticky;top:0;z-index:10;background:var(--bg);padding-top:8px}
.tab{flex:1;background:var(--bg2);border:none;color:var(--t3);padding:10px 0;border-radius:10px;font-family:var(--font);font-size:14px;font-weight:500;cursor:pointer;transition:all .2s var(--ease)}
.tab.active{background:var(--t1);color:var(--bg);box-shadow:var(--shadow)}
.tab:not(.active):hover{color:var(--t2)}

/* ── Content ── */
.content{padding:0 16px 32px}

/* ── Loop card ── */
.card{background:var(--bg1);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:10px;cursor:pointer;-webkit-tap-highlight-color:transparent;transition:transform .15s var(--ease),border-color .2s,box-shadow .2s;box-shadow:var(--shadow)}
.card:active{transform:scale(.98);box-shadow:var(--shadow2)}
.card-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.card-title{font-size:16px;font-weight:600;letter-spacing:-0.2px;flex:1;margin-right:12px;line-height:1.3}
.badge{font-size:11px;font-weight:600;padding:4px 10px;border-radius:8px;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}
.badge-running{color:var(--green);background:#34D39915}
.badge-gating{color:var(--blue);background:#7B93DB15}
.badge-handoff{color:var(--orange);background:#F6821F15}
.badge-failing{color:var(--red);background:#F8717115}

.card-agents{display:flex;gap:6px;margin-bottom:12px;align-items:center}
.agent-chip{display:flex;align-items:center;gap:4px;font-size:12px;color:var(--t2);background:var(--bg2);padding:3px 8px;border-radius:6px}
.agent-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}

/* Progress ring / bar */
.card-progress{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.progress-ring{position:relative;width:40px;height:40px;flex-shrink:0}
.progress-ring svg{transform:rotate(-90deg)}
.progress-ring-bg{fill:none;stroke:var(--bg3);stroke-width:3}
.progress-ring-fill{fill:none;stroke-width:3;stroke-linecap:round;transition:stroke-dashoffset .6s var(--ease)}
.progress-ring-text{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--t2)}
.progress-info{flex:1}
.progress-label{font-size:13px;color:var(--t2)}
.progress-sub{font-size:11px;color:var(--t3)}

/* Session dots */
.card-sessions{display:flex;gap:3px;align-items:center}
.ses-pip{width:8px;height:8px;border-radius:50%;transition:transform .15s var(--ease)}
.ses-pip.s-pass{background:var(--green)}
.ses-pip.s-fail{background:var(--red)}
.ses-pip.s-handoff{background:var(--orange)}
.ses-pip.s-active{background:var(--green);animation:pulse 2s ease-in-out infinite}
.ses-count{font-size:11px;color:var(--t3);margin-left:6px}

/* ── Queue item ── */
.q-card{background:var(--bg1);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin-bottom:8px;cursor:pointer;-webkit-tap-highlight-color:transparent;transition:transform .15s var(--ease);box-shadow:var(--shadow)}
.q-card:active{transform:scale(.98)}
.q-num{font-size:12px;color:var(--t3);margin-bottom:2px}
.q-prompt{font-size:15px;color:var(--t1);font-weight:500}

/* ── Done item ── */
.d-card{background:var(--bg1);border:1px solid var(--border);border-radius:14px;padding:14px 16px;margin-bottom:8px;box-shadow:var(--shadow)}
.d-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}
.d-prompt{font-size:14px;color:var(--t2)}
.d-meta{font-size:11px;color:var(--t3);display:flex;gap:8px;margin-top:4px;align-items:center}
.d-agents-row{display:flex;gap:3px}

/* ── Sheet (detail) ── */
.sheet-bg{position:fixed;inset:0;background:rgba(0,0,0,.25);z-index:50;opacity:0;pointer-events:none;transition:opacity .25s var(--ease);-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}
[data-theme="dark"] .sheet-bg{background:rgba(0,0,0,.6)}
.sheet-bg.open{opacity:1;pointer-events:auto}
.sheet{position:fixed;left:0;right:0;bottom:0;z-index:60;background:var(--bg1);border-top-left-radius:20px;border-top-right-radius:20px;max-height:88vh;overflow-y:auto;transform:translateY(100%);transition:transform .35s var(--ease);-webkit-overflow-scrolling:touch}
.sheet.open{transform:translateY(0)}
.sheet-handle{width:36px;height:4px;background:var(--bg3);border-radius:2px;margin:10px auto 0}
.sheet-body,.picker-body{padding:20px 20px 32px}

/* Sheet content */
.sh-title{font-size:20px;font-weight:700;letter-spacing:-0.3px;margin-bottom:4px;line-height:1.3}
.sh-dir{font-size:12px;color:var(--t3);margin-bottom:16px;word-break:break-all}

.sh-section{margin-bottom:20px}
.sh-label{font-size:11px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}

/* Token bar */
.tok-bar{height:4px;background:var(--bg3);border-radius:2px;overflow:hidden;margin-top:6px}
.tok-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--red));border-radius:2px;transition:width .5s var(--ease)}
.tok-labels{display:flex;justify-content:space-between;font-size:12px;color:var(--t2)}

/* Gate rows */
.gate-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border)}
.gate-row:last-child{border-bottom:none}
.gate-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.gate-dot.gp{background:var(--green)}.gate-dot.gf{background:var(--red)}.gate-dot.gpn{background:var(--bg3)}
.gate-name{flex:1;font-size:14px;color:var(--t1)}
.gate-st{font-size:12px;font-weight:600}
.gate-st.gp{color:var(--green)}.gate-st.gf{color:var(--red)}.gate-st.gpn{color:var(--t3)}

/* Session rows */
.sh-ses{padding:12px 0;border-bottom:1px solid var(--border)}
.sh-ses:last-child{border-bottom:none}
.sh-ses-top{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.sh-ses-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.sh-ses-num{font-size:12px;font-weight:600;color:var(--t3)}
.sh-ses-sum{font-size:14px;color:var(--t1);flex:1}
.sh-ses-meta{display:flex;flex-wrap:wrap;gap:6px;align-items:center;margin-top:4px}
.sh-chip{font-size:11px;color:var(--t2);background:var(--bg2);padding:2px 8px;border-radius:5px;display:inline-flex;align-items:center;gap:4px}
.sh-chip-dot{width:5px;height:5px;border-radius:50%}
.sh-sha{font-size:11px;color:var(--gold);opacity:.7}
.sh-tok{font-size:11px;color:var(--t3)}

/* Git audit */
.git-row{display:flex;gap:8px;padding:4px 0;font-size:12px}
.git-sha{color:var(--gold);font-weight:600;flex-shrink:0;min-width:56px}
.git-msg{color:var(--t2);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.git-agent{color:var(--t3);flex-shrink:0;font-size:11px}

/* Actions */
.sh-actions{display:flex;gap:8px;margin-top:4px}
.btn{flex:1;padding:12px;border-radius:10px;border:none;font-family:var(--font);font-size:14px;font-weight:600;cursor:pointer;transition:all .15s var(--ease);-webkit-tap-highlight-color:transparent}
.btn:active{transform:scale(.97)}
.btn-primary{background:var(--t1);color:var(--bg)}
.btn-secondary{background:var(--bg2);color:var(--t2);border:1px solid var(--border)}
.btn-danger{background:#7f1d1d44;color:var(--red);border:1px solid #7f1d1d}

/* ── Picker sheet ── */
.picker-sheet{z-index:70}
.pick-title{font-size:18px;font-weight:700;margin-bottom:4px}
.pick-sub{font-size:13px;color:var(--t3);margin-bottom:16px}
.pick-label{font-size:11px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.pick-agents{display:flex;gap:8px;margin-bottom:20px}
.pick-agent{flex:1;background:var(--bg2);border:2px solid var(--border);border-radius:12px;padding:14px 8px;text-align:center;cursor:pointer;transition:all .2s var(--ease);-webkit-tap-highlight-color:transparent}
.pick-agent:active{transform:scale(.96)}
.pick-agent.picked{border-color:var(--gold)}
.pick-agent-dot{width:12px;height:12px;border-radius:50%;margin:0 auto 8px}
.pick-agent-name{font-size:14px;font-weight:600}
.pick-routers{display:flex;gap:6px;margin-bottom:24px}
.pick-router{flex:1;background:var(--bg2);border:2px solid var(--border);border-radius:10px;padding:10px 6px;text-align:center;cursor:pointer;font-size:13px;font-weight:500;color:var(--t2);transition:all .2s var(--ease);-webkit-tap-highlight-color:transparent}
.pick-router:active{transform:scale(.96)}
.pick-router.picked{border-color:var(--gold);color:var(--t1)}

/* ── Empty state ── */
.empty{text-align:center;padding:48px 16px;color:var(--t3)}
.empty-icon{font-size:32px;margin-bottom:8px;opacity:.3}
.empty-text{font-size:14px}
.empty-sub{font-size:12px;color:var(--t3);margin-top:4px;font-family:'Sora',sans-serif}
.card-meta-row{margin:8px 0;font-size:13px;color:var(--t2)}
.card-meta{color:var(--t3)}

/* ── Top actions ── */
.top-actions{position:fixed;top:12px;right:12px;z-index:40;display:flex;gap:6px}
.icon-btn{width:36px;height:36px;border-radius:50%;border:1px solid var(--border);background:var(--bg1);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all .2s var(--ease);box-shadow:var(--shadow);-webkit-tap-highlight-color:transparent;color:var(--t2)}
.icon-btn:active{transform:scale(.9)}
#theme-toggle::after{content:'\263E'}
[data-theme="dark"] #theme-toggle::after{content:'\2600'}

/* ── Settings ── */
.cfg-section{margin-bottom:20px}
.cfg-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:10px;margin-bottom:6px}
.cfg-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.cfg-dot.ok{background:var(--green)}
.cfg-dot.miss{background:var(--red)}
.cfg-dot.warn{background:var(--orange)}
.cfg-info{flex:1}
.cfg-name{font-size:14px;font-weight:600}
.cfg-detail{font-size:11px;color:var(--t3)}
.cfg-badge{font-size:10px;font-weight:600;padding:2px 8px;border-radius:6px}
.cfg-badge.ok{color:var(--green);background:#16A34A12}
.cfg-badge.miss{color:var(--red);background:#DC262612}
.cfg-keys{margin-top:6px;padding-left:20px}
.cfg-key{display:flex;align-items:center;gap:8px;padding:6px 0;font-size:12px;border-bottom:1px solid var(--border)}
.cfg-key:last-child{border-bottom:none}
.cfg-key-name{color:var(--t2);flex:1}
.cfg-key-val{font-family:monospace;font-size:11px;color:var(--t3)}
.cfg-key-status{font-size:10px;font-weight:600}
.cfg-key-status.ok{color:var(--green)}
.cfg-key-status.miss{color:var(--red)}

/* ── Level bar (XP style) ── */
.level-bar{margin-top:12px}
.level-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.level-label{font-size:11px;color:var(--t3)}
.level-xp{font-size:11px;font-weight:600;color:var(--t2)}
.level-track{height:6px;background:var(--bg3);border-radius:3px;overflow:hidden}
.level-fill{height:100%;border-radius:3px;transition:width .8s var(--ease)}
.level-fill.lv-green{background:linear-gradient(90deg,#059669,var(--green))}
.level-fill.lv-blue{background:linear-gradient(90deg,#2563eb,var(--blue))}
.level-fill.lv-orange{background:linear-gradient(90deg,#c2410c,var(--orange))}
.level-fill.lv-red{background:linear-gradient(90deg,#991b1b,var(--red))}

/* ── Done card (unlocked) ── */
.d-card{position:relative;overflow:hidden}
.d-card::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from 0deg,transparent,rgba(200,166,48,.06),transparent,rgba(200,166,48,.06),transparent);animation:sheen 8s linear infinite;pointer-events:none}
[data-theme="dark"] .d-card::before{background:conic-gradient(from 0deg,transparent,rgba(232,200,114,.04),transparent,rgba(232,200,114,.04),transparent)}
@keyframes sheen{to{transform:rotate(360deg)}}
.d-check{font-size:16px;color:var(--green);margin-right:8px}
.d-prompt{font-size:15px;font-weight:500;color:var(--t1)}
.d-card .d-meta{margin-top:6px}

/* ── Unlock flash (when all gates pass) ── */
.unlock-flash{position:fixed;inset:0;z-index:300;display:flex;align-items:center;justify-content:center;background:var(--bg);pointer-events:none;animation:unlockSeq 3.5s var(--ease) forwards;transition:background .3s}
.unlock-content{text-align:center;opacity:0;transform:scale(.92) translateY(8px);animation:unlockIn .7s .4s var(--ease) forwards}
.unlock-ring{width:72px;height:72px;border-radius:50%;border:3px solid var(--green);margin:0 auto 20px;display:flex;align-items:center;justify-content:center;font-size:32px;color:var(--green);opacity:0;animation:unlockPop .5s .7s var(--ease) both}
.unlock-title{font-size:24px;font-weight:700;letter-spacing:-0.5px;margin-bottom:6px}
.unlock-sub{font-size:13px;color:var(--t3);letter-spacing:2px;text-transform:uppercase}
@keyframes unlockIn{to{opacity:1;transform:scale(1) translateY(0)}}
@keyframes unlockPop{from{opacity:0;transform:scale(0)}to{opacity:1;transform:scale(1)}}
@keyframes unlockSeq{0%,75%{opacity:1}100%{opacity:0;pointer-events:none}}

/* ── Spinner ── */
.spinner{display:inline-block;width:10px;height:10px;border:2px solid var(--green);border-top-color:transparent;border-radius:50%;animation:spin .8s linear infinite;vertical-align:middle;margin-right:4px}
@keyframes spin{to{transform:rotate(360deg)}}

/* ── Toast ── */
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--t1);color:var(--bg);padding:10px 20px;border-radius:10px;font-size:13px;font-weight:500;z-index:500;opacity:0;transition:all .3s var(--ease);box-shadow:var(--shadow2);max-width:90vw;text-align:center}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast-err{background:var(--red);color:#fff}

/* ── Stale card ── */
.card-stale{border-color:var(--orange)}
.chip-time{color:var(--t3);font-variant-numeric:tabular-nums}
.chip-warn{color:var(--orange);background:#F6821F15;font-weight:600}
[data-theme="dark"] .chip-warn{background:#F6821F22}

/* ── Delete button ── */
.del-btn{background:none;border:none;color:var(--t3);font-size:16px;cursor:pointer;padding:4px 8px;border-radius:6px;transition:all .15s;-webkit-tap-highlight-color:transparent;flex-shrink:0}
.del-btn:hover,.del-btn:active{color:var(--red);background:#F8717115}
.q-top{display:flex;align-items:center;gap:8px}

/* ── Step indicator ── */
.step-bar{display:flex;gap:8px;justify-content:center;margin:16px 0 20px}
.step-dot{width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;background:var(--bg2);color:var(--t3);border:2px solid var(--border);transition:all .25s var(--ease)}
.step-dot.current{border-color:var(--gold);color:var(--gold);background:var(--bg)}
.step-dot.done{border-color:var(--green);background:var(--green);color:#fff}

/* ── Step nav ── */
.step-nav{display:flex;gap:8px;margin-top:20px}

/* ── Model list ── */
.model-list{display:flex;flex-direction:column;gap:4px}
.model-opt{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--bg2);border:2px solid var(--border);border-radius:10px;cursor:pointer;transition:all .15s var(--ease);-webkit-tap-highlight-color:transparent}
.model-opt:active{transform:scale(.98)}
.model-opt.picked{border-color:var(--gold)}
.model-name{font-size:14px;font-weight:500}
.model-check{color:var(--green);font-weight:700;font-size:16px}

/* ── FAB ── */
.fab{position:fixed;bottom:24px;right:24px;z-index:40;width:56px;height:56px;border-radius:50%;border:none;background:var(--t1);color:var(--bg);font-size:28px;font-weight:300;cursor:pointer;box-shadow:var(--shadow2);display:flex;align-items:center;justify-content:center;transition:all .2s var(--ease);-webkit-tap-highlight-color:transparent;font-family:var(--font)}
.fab:active{transform:scale(.9)}
.fab:hover{box-shadow:0 6px 20px rgba(0,0,0,.15)}
[data-theme="dark"] .fab{background:var(--bg3);color:var(--t1);box-shadow:0 4px 12px rgba(0,0,0,.5)}

/* ── Add form ── */
.add-form{margin-top:16px}
.add-label{display:block;font-size:12px;font-weight:600;color:var(--t3);margin-bottom:4px;margin-top:12px}
.add-label:first-child{margin-top:0}
.add-input{display:block;width:100%;background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:12px;font-family:var(--font);font-size:15px;color:var(--t1);resize:none;transition:border-color .15s}
.add-input:focus{outline:none;border-color:var(--gold)}
.add-input::placeholder{color:var(--t3)}
.add-btn{width:100%;margin-top:20px;padding:14px}
.add-btn:disabled{opacity:.5;cursor:default;transform:none}

/* ── Responsive (already mobile-first, add desktop) ── */
@media(min-width:768px){
  .app{max-width:640px}
  .card{padding:20px}
  .sheet{max-width:640px;left:50%;right:auto;transform:translateX(-50%) translateY(100%)}
  .sheet.open{transform:translateX(-50%) translateY(0)}
  .picker-sheet{max-width:480px}
}
